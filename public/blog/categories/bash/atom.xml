<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: Bash | Robby Grossman]]></title>
  <link href="http://rob.by/blog/categories/bash/atom.xml" rel="self"/>
  <link href="http://rob.by/"/>
  <updated>2013-08-04T16:58:13-04:00</updated>
  <id>http://rob.by/</id>
  <author>
    <name><![CDATA[Robby Grossman]]></name>
    <email><![CDATA[robby@freerobby.com]]></email>
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Remove Merged Branches from Git]]></title>
    <link href="http://rob.by/2013/remove-merged-branches-from-git/"/>
    <updated>2013-01-26T16:28:00-05:00</updated>
    <id>http://rob.by/2013/remove-merged-branches-from-git</id>
    <content type="html"><![CDATA[<p>I wrote a bash function that prunes a git repository’s ancestral branches, helping you keep your local and remote repos tidy.</p>

<p>This function removes all branches, local and remote, that have been merged into your current branch. Simply run “rmb” from the command line. Don’t worry - prompt safeguards are in place to show you what you’ll be removing before it delets anything. And it won’t let you delete “master.” :-)</p>

<p>Add this to your ~/.profile, run “source ~/.profile” and you’re good to go.</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>rmb.sh </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="k">function </span>rmb <span class="o">{</span>
</span><span class='line'>  <span class="nv">current_branch</span><span class="o">=</span><span class="k">$(</span>git branch –no-color 2&amp;gt; /dev/null | sed -e ‘/^<span class="o">[</span>^&lt;em&gt;<span class="o">]</span>/d’ -e ‘s/&lt;/em&gt; <span class="o">(</span>.*<span class="k">)</span>/<span class="se">\1</span>/’<span class="o">)</span>
</span><span class='line'>  <span class="k">if</span> <span class="o">[</span> “<span class="nv">$current_branch</span>” !<span class="o">=</span> “master” <span class="o">]</span>; <span class="k">then</span>
</span><span class='line'><span class="k">    </span><span class="nb">echo</span> “WARNING: You are on branch <span class="nv">$current_branch</span>, NOT master.”
</span><span class='line'>  <span class="k">fi</span>
</span><span class='line'><span class="k">    </span><span class="nb">echo</span> “Fetching merged branches…”
</span><span class='line'>  git remote prune origin
</span><span class='line'>  <span class="nv">remote_branches</span><span class="o">=</span><span class="k">$(</span>git branch -r –merged | grep -v ‘/master<span class="nv">$’</span> | grep -v “/<span class="nv">$current_branch$”</span><span class="k">)</span>
</span><span class='line'>  <span class="nv">local_branches</span><span class="o">=</span><span class="k">$(</span>git branch –merged | grep -v ‘master<span class="nv">$’</span> | grep -v “<span class="nv">$current_branch$”</span><span class="k">)</span>
</span><span class='line'>  <span class="k">if</span> <span class="o">[</span> -z “<span class="nv">$remote_branches</span>” <span class="o">]</span> &amp;amp;&amp;amp; <span class="o">[</span> -z “<span class="nv">$local_branches</span>” <span class="o">]</span>; <span class="k">then</span>
</span><span class='line'><span class="k">    </span><span class="nb">echo</span> “No existing branches have been merged into <span class="nv">$current_branch</span>.”
</span><span class='line'>  <span class="k">else</span>
</span><span class='line'><span class="k">    </span><span class="nb">echo</span> “This will remove the following branches:”
</span><span class='line'>    <span class="k">if</span> <span class="o">[</span> -n “<span class="nv">$remote_branches</span>” <span class="o">]</span>; <span class="k">then</span>
</span><span class='line'><span class="k">      </span><span class="nb">echo</span> “<span class="nv">$remote_branches</span>”
</span><span class='line'>    <span class="k">fi</span>
</span><span class='line'><span class="k">    if</span> <span class="o">[</span> -n “<span class="nv">$local_branches</span>” <span class="o">]</span>; <span class="k">then</span>
</span><span class='line'><span class="k">      </span><span class="nb">echo</span> “<span class="nv">$local_branches</span>”
</span><span class='line'>    <span class="k">fi</span>
</span><span class='line'><span class="k">    </span><span class="nb">read</span> -p “Continue? <span class="o">(</span>y/n<span class="o">)</span>: “ -n 1 choice
</span><span class='line'>    <span class="nb">echo</span>
</span><span class='line'><span class="nb">    </span><span class="k">if</span> <span class="o">[</span> “<span class="nv">$choice</span>” <span class="o">==</span> “y” <span class="o">]</span> <span class="o">||</span> <span class="o">[</span> “<span class="nv">$choice</span>” <span class="o">==</span> “Y” <span class="o">]</span>; <span class="k">then</span>
</span><span class='line'>      <span class="c"># Remove remote branches</span>
</span><span class='line'>      git push origin &lt;code&gt;git branch -r --merged | grep -v <span class="s1">&#39;/master$&#39;</span> | grep -v <span class="s2">&quot;/$current_branch$&quot;</span> | sed <span class="s1">&#39;s/origin\//:/g&#39;</span> | tr -d <span class="s1">&#39;\n&#39;</span>&lt;/code&gt;
</span><span class='line'>      <span class="c"># Remove local branches</span>
</span><span class='line'>      git branch -d &lt;code&gt;git branch --merged | grep -v <span class="s1">&#39;master$&#39;</span> | grep -v <span class="s2">&quot;$current_branch$&quot;</span> | sed <span class="s1">&#39;s/origin\///g&#39;</span> | tr -d <span class="s1">&#39;\n&#39;</span>&lt;/code&gt;
</span><span class='line'>    <span class="k">else</span>
</span><span class='line'><span class="k">      </span><span class="nb">echo</span> “No branches removed.”
</span><span class='line'>    <span class="k">fi</span>
</span><span class='line'><span class="k">  fi</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

]]></content>
  </entry>
  
</feed>
